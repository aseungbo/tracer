<template>
  <v-app-bar class="d-flex justify-center" style="height: 5rem">
    <div class="w-100 d-flex justify-space-between align-center px-4 px-sm-16">
      <div class="d-flex align-center flex-shrink-0" style="gap: 0.25rem">
        <v-icon :color="twColors.palette.blue" size="2rem">mdi-lightning-bolt</v-icon>
        <NuxtLink style="cursor: pointer">
          <span class="text-h6 font-weight-bold">Tracer</span>
        </NuxtLink>
      </div>
      <div class="d-flex" style="gap: 1rem">
        <div class="d-flex" style="gap: 1rem">
          <v-btn variant="flat" @click="dialog = true" :color="twColors.palette.blue">
            <span
              class="text-subtitle-1 font-weight-bold"
              :style="`color: ${twColors.palette.white};`"
            >
              ì‹œì‘í•˜ê¸°
            </span>
          </v-btn>
        </div>
      </div>
    </div>
  </v-app-bar>
  <div class="d-flex flex-column align-center" style="gap: 5rem">
    <div class="text-center" style="margin-top: 114px">
      <p class="text-sm-h2 mb-4" style="font-size: 40px; font-weight: 600">
        ë¬¸ì„œ <span :style="`color: ${twColors.palette.blue};`">ì·¨í•©</span>ì„
      </p>
      <p class="text-sm-h2" style="font-size: 40px; font-weight: 600">
        <span :style="`color: ${twColors.palette.blue};`">ê°„í¸</span>í•˜ê³ 
        <span :style="`color: ${twColors.palette.blue};`">ì•ˆì „</span>í•˜ê²Œ
      </p>
    </div>

    <div>
      <v-btn
        style="min-width: 293px; height: 60px"
        @click="dialog = true"
        variant="flat"
        :color="twColors.palette.blue"
      >
        <span
          class="text-subtitle-1 text-sm-h6"
          style="font-weight: 600"
          :style="`color: ${twColors.palette.white};`"
        >
          ì‹œì‘í•˜ê¸°
        </span>
      </v-btn>
    </div>
    <div>
      <v-img class="gif-style" aspect-ratio="16/9" cover :src="requestGif"></v-img>
    </div>
    <div class="text-center" style="margin-top: 60px">
      <p class="text-sm-h2 mb-16 px-4" style="font-size: 28px; font-weight: 600">
        ë¬¸ì„œ ì·¨í•©, ê·¸ë™ì•ˆ ì–´ë–»ê²Œ í•˜ê³  ê³„ì…¨ì–´ìš”?
      </p>
    </div>
    <div class="d-flex flex-wrap justify-center" style="gap: 6rem">
      <div>
        <v-img
          class="gif-style"
          aspect-ratio="5/5"
          style="border-radius: 0.5rem; width: 300px; height: 300px"
          cover
          :src="emailAndMessengerPng"
        ></v-img>
        <p
          class="text-sm-h6 px-8 text-center mt-8"
          style="
            color: #00000066;
            font-size: 1rem;
            font-weight: 600;
            width: 300px;
            line-height: 2rem;
          "
        >
          <span :style="`color: ${twColors.palette.red};`">ë©”ì‹ ì €, ì´ë©”ì¼</span>ë¡œ ìš”ì²­í•˜ê³ 
        </p>
      </div>
      <div>
        <v-img
          class="gif-style"
          aspect-ratio="5/5"
          style="border-radius: 0.5rem; width: 300px; height: 300px"
          cover
          :src="downloadPng"
        ></v-img>
        <p
          class="text-sm-h6 px-8 text-center mt-8"
          style="
            color: #00000066;
            font-size: 1rem;
            font-weight: 600;
            width: 320px;
            line-height: 2rem;
          "
        >
          <span :style="`color: ${twColors.palette.red};`">ì—°ë½ì´ ì˜¬ ë•Œë§ˆë‹¤ </span>ë‹¤ìš´ë¡œë“œë°›ê³ 
        </p>
      </div>
      <div>
        <v-img
          class="gif-style"
          aspect-ratio="5/5"
          style="border-radius: 0.5rem; width: 300px; height: 300px"
          cover
          :src="folderNaming"
        ></v-img>
        <p
          class="text-sm-h6 px-8 text-center mt-8"
          style="
            color: #00000066;
            font-size: 1rem;
            font-weight: 600;
            width: 300px;
            line-height: 2rem;
          "
        >
          <span :style="`color: ${twColors.palette.red};`">í´ë” ì´ë¦„</span>ìœ¼ë¡œ
          <span :style="`color: ${twColors.palette.red};`">ê´€ë¦¬</span>í•˜ì…¨ì£ ?
        </p>
      </div>
    </div>

    <div class="text-center" style="margin-top: 60px">
      <p class="text-sm-h2 mb-8 px-4" style="font-size: 32px; font-weight: 600">
        ì´ì œëŠ” ê°„í¸í•˜ê²Œ ì·¨í•©í•˜ì„¸ìš”
      </p>
      <p class="text-sm-h5 px-8 mb-2" style="color: #00000066; font-size: 16px; font-weight: 600">
        ëª¨ë“  ê³¼ì •ì€ ì•Œë¦¼ìœ¼ë¡œ ì•Œë ¤ë“œë¦¬ê³ 
      </p>
      <p class="text-sm-h5 px-8" style="color: #00000066; font-size: 16px; font-weight: 600">
        ì œì¶œëœ ë¬¸ì„œë“¤ì€ í•œëˆˆì— í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”
      </p>
    </div>
    <div class="d-flex flex-wrap justify-center" style="gap: 6rem">
      <div>
        <v-img
          class="gif-style"
          aspect-ratio="5/5"
          style="border-radius: 0.5rem; width: 300px; height: 300px"
          cover
          :src="requestPng"
        ></v-img>
        <p
          class="text-sm-h6 px-8 text-center mt-8"
          style="
            color: #00000066;
            font-size: 1rem;
            font-weight: 600;
            width: 300px;
            line-height: 2rem;
          "
        >
          <span :style="`color: ${twColors.palette.blue};`">ì²´í¬ë¦¬ìŠ¤íŠ¸</span>ë¥¼ ì‘ì„±í•´ì„œ
        </p>
        <p
          class="text-sm-h6 px-8 text-center"
          style="color: #00000066; font-size: 1rem; font-weight: 600; width: 300px"
        >
          ê³ ê°ì—ê²Œ ìš”ì²­í•˜ê³ 
        </p>
      </div>
      <div>
        <v-img
          class="gif-style"
          aspect-ratio="5/5"
          style="border-radius: 0.5rem; width: 300px"
          cover
          :src="responsePng"
        ></v-img>
        <p
          class="text-sm-h6 px-8 text-center mt-8"
          style="
            color: #00000066;
            font-size: 1rem;
            font-weight: 600;
            width: 300px;
            line-height: 2rem;
          "
        >
          ê³ ê°ì´ <span :style="`color: ${twColors.palette.blue};`">ì²´í¬ë¦¬ìŠ¤íŠ¸</span>ì— ë”°ë¼ì„œ
        </p>
        <p
          class="text-sm-h6 px-8 text-center"
          style="color: #00000066; font-size: 1rem; font-weight: 600; width: 300px"
        >
          <span :style="`color: ${twColors.palette.blue};`">ë¬¸ì„œë¥¼ ì œì¶œ</span>í•˜ë©´
        </p>
      </div>
      <div>
        <v-img
          class="gif-style"
          aspect-ratio="5/5"
          style="border-radius: 0.5rem; width: 300px"
          cover
          :src="notiAndCheckPng"
        ></v-img>
        <p
          class="text-sm-h6 px-8 text-center mt-8"
          style="
            color: #00000066;
            font-size: 1rem;
            font-weight: 600;
            width: 300px;
            line-height: 2rem;
          "
        >
          <span :style="`color: ${twColors.palette.blue};`">ì•ŒëŒì´ ì™”ì„ ë•Œ</span> í™•ì¸í•˜ê³ 
        </p>
        <p
          class="text-sm-h6 px-8 text-center"
          style="color: #00000066; font-size: 1rem; font-weight: 600; width: 300px"
        >
          <span :style="`color: ${twColors.palette.blue};`">í•„ìš”í•  ë•Œë§Œ</span> ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”
        </p>
      </div>
    </div>
    <div>
      <v-btn
        style="min-width: 293px; height: 60px"
        @click="dialog = true"
        variant="flat"
        :color="twColors.palette.blue"
      >
        <span
          class="text-subtitle-1 text-sm-h6"
          style="font-weight: 600"
          :style="`color: ${twColors.palette.white};`"
        >
          ì‚¬ì „ì˜ˆì•½í•˜ê¸°
        </span>
      </v-btn>
    </div>

    <div>
      <iframe class="video-style" :src="embedUrl" frameborder="0"></iframe>
    </div>

    <v-dialog v-model="dialog" style="min-width: 370px; max-width: 500px">
      <v-card class="align-center py-8" style="height: 40rem">
        <v-card-text v-if="!submitted" class="w-75 d-flex flex-column justify-center">
          <v-form class="w-100 d-flex flex-column align-center">
            <div class="d-flex my-4 mr-4">
              <v-icon :color="twColors.palette.blue" size="2rem">mdi-lightning-bolt</v-icon>
              <span class="text-h5 font-weight-bold">Tracer</span>
            </div>
            <p class="text-subtitle-2 text-sm-subtitle-1 font-weight-bold text-center mt-6 mb-2">
              ğŸš€ íŠ¸ë ˆì´ì„œëŠ” ì•„ì§ ì¤€ë¹„ì¤‘ì´ì—ìš”!
            </p>

            <v-text-field
              class="w-100 my-8"
              label="ë‹´ë‹¹ ì—…ë¬´"
              placeholder="ì–´ë–¤ ì—…ë¬´ë¥¼ í•˜ì‹œë‚˜ìš”?"
              hide-details
              clearable
              color="blue"
              v-model="position"
            ></v-text-field>
            <v-text-field
              class="w-100"
              label="ì´ë©”ì¼"
              placeholder="ì´ë©”ì¼"
              hide-details
              clearable
              color="blue"
              v-model="email"
            ></v-text-field>
          </v-form>
        </v-card-text>
        <v-card-text v-else class="d-flex flex-column justify-center align-center">
          <v-icon size="7rem" color="green">mdi-check-circle-outline</v-icon>
          <p class="text-subtitle-1 font-weight-bold text-center mt-2">
            ì‚¬ì „ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
          </p>
        </v-card-text>
        <v-card-actions class="d-flex flex-column" style="gap: 1rem">
          <p class="text-subtitle-2 text-sm-subtitle-1 font-weight-bold text-center mb-12">
            ğŸ”” ì‚¬ì „ì˜ˆì•½í•˜ê³  ì œí’ˆ ì¶œì‹œ ì•Œë¦¼ ë°›ê¸°
          </p>
          <v-btn
            :loading="loading"
            style="min-width: 200px; min-height: 50px"
            variant="flat"
            :color="twColors.palette.blue"
            @click="
              () => {
                submitted ? (dialog = false) : handleSubmit();
              }
            "
            ><span
              class="text-subtitle-1 font-weight-bold"
              :style="`color: ${twColors.palette.white};`"
            >
              {{ submitted ? "ë‹«ê¸°" : "ì‚¬ì „ì˜ˆì•½" }}
            </span></v-btn
          >
        </v-card-actions>
      </v-card>
    </v-dialog>
  </div>
</template>

<script></script>

<script setup>
import axios from "axios";
import requestGif from "@/assets/request.gif";
import downloadPng from "@/assets/download.png";
import emailAndMessengerPng from "@/assets/emailAndMessenger.png";
import folderNaming from "@/assets/folderNaming.png";
import requestPng from "@/assets/request.png";
import responsePng from "@/assets/response.png";
import notiAndCheckPng from "@/assets/notiAndCheck.png";

const videoUrl = ref("https://www.youtube.com/watch?v=YiiD9ddqbOc"); // ë¹„ë””ì˜¤ URL

const getVideoId = (url) => {
  const videoId = url.split("v=")[1];
  return videoId;
};

const embedUrl = computed(() => {
  const videoId = getVideoId(videoUrl.value);
  return `https://www.youtube.com/embed/${videoId}`;
});

const words = ["ëª¨ë“ ", "íšŒê³„", "ì—¬í–‰", "ë¶€ë™ì‚°"];
const typingSpeed = 200;
const eraseSpeed = 200;

const currentText = ref("");
let currentWordIndex = 0;
let isTyping = true;

const typeNextLetter = () => {
  if (isTyping) {
    currentText.value += words[currentWordIndex][currentText.value.length];
    if (currentText.value.length < words[currentWordIndex].length) {
      setTimeout(typeNextLetter, typingSpeed);
    } else {
      isTyping = false;
      setTimeout(eraseText, typingSpeed * 2);
    }
  } else {
    if (currentText.value.length > 0) {
      currentText.value = currentText.value.slice(0, -1);
      setTimeout(eraseText, eraseSpeed);
    }
  }
};

const eraseText = () => {
  if (currentText.value.length > 0) {
    currentText.value = currentText.value.slice(0, -1);
    setTimeout(eraseText, eraseSpeed);
  } else {
    isTyping = true;
    currentWordIndex++;
    if (currentWordIndex === words.length) {
      currentWordIndex = 0;
    }
    setTimeout(typeNextLetter, typingSpeed);
  }
};

const pageHeight = ref("");
const cardHeight = ref("");
const responseCardHeight = ref("");
const email = ref("");
const position = ref("");
const loading = ref(false);

const submitted = ref(false);
const dialog = ref(false);
const formSparkUrl = ref("https://submit-form.com/yuuWqUdz");

const handleSubmit = async () => {
  loading.value = true;
  await axios
    .post(formSparkUrl.value, { email: email.value, position: position.value })
    .then((response) => {
      setTimeout(() => {
        loading.value = false;
        submitted.value = true;
        email.value = "";
      }, 250);
    });
};

onMounted(() => {
  typeNextLetter();
  const viewportHeight = window.innerHeight;
  const desiredHeight = Math.round(viewportHeight * 0.85);
  pageHeight.value = `${desiredHeight}px`;
  cardHeight.value = `${desiredHeight * 0.95}px`;
  responseCardHeight.value = `${desiredHeight * 0.8}px`;
});
</script>

<style lang="scss" scoped>
.video-style {
  width: 960px;
  height: 540px;
}
@media screen and (max-width: 600px) {
  .video-style {
    width: 320px;
    height: 180px;
  }
}

.gif-style {
  width: 960px;
}
@media screen and (max-width: 600px) {
  .gif-style {
    width: 320px;
  }
}
.png-style {
  width: 640px;
}
@media screen and (max-width: 600px) {
  .png-style {
    width: 320px;
  }
}

::v-deep .v-text-field {
  .v-label {
    font-size: 1rem;
  }
  @media screen and (max-width: 600px) {
    .v-label {
      font-size: 1rem;
    }
  }
}
</style>
